<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Media Explorer</title>
  
  <!-- Pico theme -->
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@latest/css/pico.min.css">
  <!-- Basic styles -->
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/layout.css">
  <link rel="stylesheet" href="/css/theme.css">
  <!-- Component styles -->
  <link rel="stylesheet" href="/css/components/buttons.css">
  <link rel="stylesheet" href="/css/components/pinnedLaunchers.css">
  <link rel="stylesheet" href="/css/components/mediaTree.css">
  <link rel="stylesheet" href="/css/components/viewerPlayer.css">
  <link rel="stylesheet" href="/css/components/playlist.css">
<!--  <link rel="stylesheet" href="/css/components/spinner.css">-->
  <!-- 404 fav icon -->
  <link rel="icon" href="data:,">
  <!-- Media player -->
  <script>
    // flip to disable client logging without touching the file
    window.CLIENT_LOGGING_ENABLED = true;
  </script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="/media/player.js"></script>
</head>
<body>
    <!-- Top nav -->
    <h2>The Stash</h2>
    <button onclick="logout()">🚪 Logout</button>
    <button onclick="window.location.href='/dashboard.html'">📊 Dashboard</button>

    <!-- Launchers/Nav -->
    <div id="pinned-launchers">
      <div id="rom-launcher">
        <h3>🎮 Choose a Game</h3>
        <ul>
          <li><button onclick="launchEmulator('Pokemon-Red.gb',this)">Pokemon Red</button></li>
          <li><button onclick="launchEmulator('Pokemon-Emerald.gba',this)">Pokemon Emerald</button></li>
		  <li><button onclick="launchEmulator('The Legend of Zelda-Ocarina of Time.z64',this)"> Ocarina of Time</button></li>
		  <li><button onclick="launchEmulator('The Legend of Zelda-Majoras Mask.z64',this)"> Majora's Mask</button></li>
        </ul>
      </div>
	  
	  <div class="media-controls">
	    <input
	      type="text"
	      id="media-search"
	      placeholder="Search..."
	    />
	    <button id="toggle-grouping" title="Toggle A–Z grouping at root">A–Z: On</button>
	    <button class="back-btn">Back</button>
	  </div>
	  
	  
      <div id="media-launcher">
        <h3>Browse Media</h3>
        <ul>
          <li><button onclick="firstRender('Books')" class="media-btn">📚 Books</button></li>
          <li><button onclick="firstRender('TV')" class="media-btn">📺 TV</button></li>
          <li><button onclick="firstRender('Movies')" class="media-btn">🎬 Movies</button></li>
          <li><button onclick="firstRender('Music')" class="media-btn">🎵 Music</button></li>		  
        </ul>
      </div>
	    
   <!-- Top nav end-->
   </div>

    <!-- MAIN LAYOUT -->
    <div id="main-layout">
      <div id="mediaTree">Select A Media Type First...</div>
      
      <!-- New media viewer -->
      <div class="media-viewer" id="viewer-player">
        <h3>📺 Viewer</h3>
        <div id="player-container"></div>
      </div>

    <!-- Spinner -->
<!--    <div id="loading-spinner">⏳ Loading ...</div>-->

    <!-- Playlist Popup -->
    <div id="playlist-popup">
      <span class="close-btn" onclick="closePlaylist()">✖</span>
      <h3>🎵 Playlist</h3>
      <ul id="playlist-items"></ul>

      <div id="playlist-controls" style="margin: 1rem 0; text-align: center;">
        <button onclick="prevInPlaylist()">⏮ Prev</button>
        <button onclick="nextInPlaylist()">⏭ Next</button>
        <button id="shuffle-button" onclick="shufflePlaylist()">Shuffle</button>
      </div>

      <div id="popup-player"></div>
    </div>

  <!-- Main logic pulled in as ES modules -->
  <script type="module">
    // Auth (logout)
    import { logout } from '/ui/auth.js';
    window.logout = logout;

    // Virtual grouping
    import { firstRender } from '/explorer/explorer.js';

    // Emulator
    import { launchEmulator } from '/emulator/emulator.js';

    // Menu button logic
    import { attachLauncherSpinnerEvents } from '/ui/onClick.js';

    // User history media
    import { handleJumpParam } from '/media/mediaDashboard.js';

    Object.assign(window, {
      logout,
      launchEmulator,
      firstRender,
    });

    // Dashboard media
    handleJumpParam();
    window.addEventListener("DOMContentLoaded", () => {
      attachLauncherSpinnerEvents();
    });
  </script>
</body>
</html>