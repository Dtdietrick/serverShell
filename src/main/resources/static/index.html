<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Media Explorer</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h2>The Stash</h2>
  <button onclick="logout()">ğŸšª Logout</button>
  <button onclick="window.location.href='/dashboard.html'">ğŸ“Š Dashboard</button>
  
  
  <div id="pinned-launchers">
    <div id="rom-launcher">
      <h3>ğŸ® Choose a Game</h3>
      <ul>
        <li><button onclick="launchEmulator('Pokemon-Red.gb',this)">ğŸŸ¥ Pokemon Red</button></li>
        <li><button onclick="launchEmulator('Pokemon-Emerald.gba',this)">ğŸŸ¢ Pokemon Emerald</button></li>
      </ul>
    </div>
    <div id="media-launcher">
      <h3>ğŸ“ Browse Media</h3>
      <ul>
        <li><button onclick="renderFolder('Books')" class="media-btn">ğŸ“š Books</button></li>
        <li><button onclick="renderFolder('TV')" class="media-btn">ğŸ“º TV</button></li>
        <li><button onclick="renderFolder('Movies')" class="media-btn">ğŸ¬ Movies</button></li>
        <li><button onclick="renderFolder('Music')" class="media-btn">ğŸµ Music</button></li>
      </ul>
    </div>
    <input
      type="text"
      id="media-search"
      placeholder="Search..."
      style="display: none; margin: 0.5rem 1rem; padding: 0.3rem; width: 80%;"
    />
    <div id="back-button">â¬…ï¸ Back</div>
  </div>
  

  <div id="main-layout">
    <div id="mediaTree">Select A Media Type First...</div>
    <div id="player"></div>
  </div>
  
  <div id="loading-spinner">â³ Loading ...</div>
  

  <!-- Playlist popup UI -->
  <div id="playlist-popup">
    <span class="close-btn" onclick="closePlaylist()">âœ–</span>
    <h3>ğŸµ Playlist</h3>
    <ul id="playlist-items"></ul>

    <div id="playlist-controls" style="margin: 1rem 0; text-align: center;">
      <button onclick="prevInPlaylist()">â® Prev</button>
      <button onclick="nextInPlaylist()">â­ Next</button>
      <button id="shuffle-button" onclick="shufflePlaylist()">ğŸ”€ Shuffle</button>
    </div>

    <div id="popup-player"></div>
  </div>

  <!-- Main logic pulled in as ES modules -->
  <script type="module">
    // Auth (logout)
    import { logout } from '/ui/auth.js';
    window.logout = logout;

    // Core explorer logic
    import {
      playMedia,
      stopAllMedia,
      applyPlayerSettings
    } from '/explorer/mediaExplorer.js';

    //virtual grouping
    import { 
        renderFolder,
        renderVirtualGroup 
    } from '/explorer/virtualExplorer.js';
    //backBtn
    import { updateBackButtonVisibility } from "/ui/backButton.js";
    // Playlist logic
    import {
      initPlaylist,
      setPlayMediaCallback,
      loadPlaylist,
      nextInPlaylist,
      prevInPlaylist,
      closePlaylist,
      shufflePlaylist
    } from '/media/playlistManager.js';

    import { launchEmulator } from '/emulator/emulator.js';
    import { attachLauncherSpinnerEvents } from "/ui/onClick.js";
    
    Object.assign(window, {
      logout,
      launchEmulator,
      //media
      renderFolder,
      renderVirtualGroup,
      playMedia,
      stopAllMedia,
      applyPlayerSettings,
      updateBackButtonVisibility,
      //playlists
      loadPlaylist,
      nextInPlaylist,
      prevInPlaylist,
      closePlaylist,
      shufflePlaylist
    });
    
    // Wire up playlist â†’ player interaction
    setPlayMediaCallback(playMedia);
    //emulator
    initPlaylist();
    
    window.addEventListener("DOMContentLoaded", () => {
      attachLauncherSpinnerEvents();
    });
  </script>
  
</body>
</html>